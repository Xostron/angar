# Аварийное сообщение. "Частое включение"

# 1. Краткое описание

Тип склада: все
Данная авария срабатывает при частом включении-выключении вентилятора.
Аварийное сообщение показывается на страницах "Сигналы", "Секции", "Секция Х". Склад закрывает все клапаны и выключает вентиляторы.

# 2. Условия

-   Склад вкл/выкл
-   Секция в любом режиме
-   "Количество переключений" = 0 - отключение функции
-   "Время дребезга контакторов" = 0 - отключение функции
-   "Время ожидания" = 0 - отключение функции

# 3. Путь к настройкам

-   для обычных и комбинированных складов: Настройки -> системные настройки -> Авария "Частое включение ВНО"
-   для складов Холодильник: Настройки -> Холодильник -> Авария "Частое включение ВНО"

# 4. Описание настроек

1.  Количество переключений - сколько раз система будет наблюдать за включение и выключением ВНО, после которого установится авария (заводское минимальное значение: 3)
2.  Время дребезга контакторов - если в течении указанного времени ВНО включится и выключится n раз, то установится авария (заводское значение: 10 сек)
3.  Время ожидания - время, по истечению которого авария автоматически сбросится (заводское значение: 30 мин)

# 5. Описание (программист)

Путь `src\control\extra\extralrm\def\deb_do\index.js`
Код `debdo`
Принадлежность: для каждого вентилятора

1. Для каждого вентилятора (разгонные, напорные, ВНО испарителей) в store.debounce создается очередь store.debounce[fan._id], в данных очередях фиксируются вкл/выкл управлящий сигнал ВНО и время возникновения {DO, date}
2. Когда размер очереди достигает настройки "Количество переключений" начинается расчет времени между последний и первым изменением.
3. Если расчетное время дельта меньше "Время дребезга контакторов" -> устанавливается авария
4. Авария сбрасывается по кнопке в мобильном или web приложении, по "нулевым настройка" и автоматически по таймеру ("Время ожидания")
5. При сбросе аварии: очищается аккумулятор acc, store.debounce и аварийное сообщение. Аккумуляторы нужно очищать, чтобы в следующем цикле не возникло повторной установки аварии.
