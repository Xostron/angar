# Авария "Антивьюга"

# 1. Краткое описание:

Тип склада: для обычных и комбинированных
Возникает, если приточный клапан был закрыт n раз в течении 30 мин, через 1 час авария автоматически сбрасывается. Аварийное сообщение показывается на страницах "Сигналы", "Секции", "Секция Х". Склад закрывает все клапаны и выключает вентиляторы.

# 2. Условия:

-   Склад включен
-   Секция в авто режиме
-   Нет настроек
-   Режим антивьюги в настройках выключен
-   Приточные клапана исправны

# 3. Путь к настройкам

Настройки -> Антивьюга

# 4. Описание настроек

1. Режим управления: Авто - слежение по времени, Выключен (заводское значение: Авто)
2. Число хлопков - количество раз, когда приточный клапан был закрыт (заводское значение: 3)
3. Время для числа хлопков - если клапан был n раз открыт за данное время, то установка аврии (заводское значение: 30 мин)
4. Время ожидания - время, по истечению которого авария автоматически сбросится (заводское значение: 1 час)

# 5. Описание (программист)

Путь `src\control\extra\extralrm\def\antibliz\index.js`
Код `antibliz`
Принадлежность: для каждой секции

1. Сначала проверяется разрешение на работу функции (проверка условий аварии: склад включен, секция в авто, имеются настройки, режим управления антивьюги - Авто, имеется приточный клапан)
2. В аккумуляторе создается очередь состояний приточного клапана acc.queue, в данную очередь записывается состояние клапан закрыт 'cls' и все остальные 'other', чтобы зафиксировать число хлопков закрытого состояния, размер очереди вычисляется по `queue.length = число хлопков х 2`
3. Из очереди отфильтровываем состояния когда закрытого клапана, если их >= числу хлопков, то проверяем время между первым и последним изменением состояния.
4. Расчетная дельта меньше "Время для числа хлопков" -> установка аварии
5. Засекается таймер сброса аварии.
6. Сброс аварии: по таймеру, по нажатию кнопки, переключение режима секции с авто на что-либо, выключили склад, обнулили настройки, выключили антивьюгу ( настройка "Режим управления")
