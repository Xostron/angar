# Авария "Аварийное закрытие клапанов"

# 1. Краткое описание:

Тип склада: Обычный, комбинированный
Возникает, когда внешний сигнал приходит в модуль ПЛК. 

# 2. Условия:

-   Склад вкл/выкл
-   Cекция в любом режиме
-	

# 3. Путь к настройкам

Настройки -> Системные настройки -> Авария питания

# 4. Описание настроек

1. Количество отключений питания: кол-во переходов POS-терминала на питание от батареи (заводское значение: 3)
2. Время подсчета - время, в течении которого произошло n перключений на питание от батареи (заводское значение: 30 мин)

# 5. Описание (программист)

Путь `src\control\extra\extralrm\def\battery\index.js`
Код `battery`
Принадлежность: склад

1. В аккумуляторе создается очередь состояний питания acc.queue, размер очереди зависит от настройки "Количество отключений питания"
2. Когда очередь стала >= "Количество отключений питания", то проверяем время между первым и последним изменением состояния.
3. Расчетная дельта меньше "Время подсчета" -> установка аварии
4. Сброс аварии: только оператором через мобильное/web приложение
